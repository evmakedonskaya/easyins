var citadela=citadela||{};citadela.ajax=citadela.ajax||{},citadela.headerMap=citadela.headerMap||{},function(e,t,i){"use strict";var a="undefined"==typeof CitadelaDirectorySettings?{}:CitadelaDirectorySettings;function n(e){var t=window,i=document,a=i.documentElement,n=i.getElementsByTagName("body")[0];return(t.innerWidth||a.clientWidth||n.clientWidth)<parseInt(e)}citadela=jQuery.extend(citadela,a),jQuery.each(["get","post"],(function(e,t){citadela.ajax[t]=function(e,i){var a;return a=e.split(":").length>1&&e in citadela.ajax.actions?citadela.ajax.actions[e]:e,i="object"==typeof i?jQuery.param(jQuery.extend(i,{action:a})):"string"==typeof i?jQuery.param({action:a})+"&"+i:jQuery.param({action:a}),jQuery.ajax({url:citadela.ajax.url,type:t,data:i})}}));var r={container:null,init:function(){var e=this,t=jQuery(".ctdl-directory-advanced-filters");return e.container=t,t.on("advancedFiltersInit",null,(function(){e.applyClosedOnMobile(jQuery(this)),e.applyToggle(jQuery(this)),e.applyCheckboxClick(jQuery(this)),e.applySubmitButtonClick(jQuery(this))})),t.trigger("advancedFiltersInit"),t.on("advancedFiltersBlockToggle",null,(function(){e.blockToggle(jQuery(this))})),t.data("advancedFilters",e),this},applyClosedOnMobile:function(e){var t=this;e.hasClass("closed-on-mobile")&&(t.setDeviceState(e),t.toggleOnMobile(e),jQuery(window).resize((function(){t.toggleDeviceState(e)})))},toggleOnMobile:function(e){e.hasClass("mobile-size")?this.toggleAdvancedHeader(e,"close"):e.hasClass("desktop-size")&&this.toggleAdvancedHeader(e,"open")},setDeviceState:function(e){n(600)?(e.addClass("mobile-size"),e.removeClass("desktop-size")):(e.addClass("desktop-size"),e.removeClass("mobile-size"))},toggleDeviceState:function(e){n(600)?(e.hasClass("desktop-size")&&this.toggleAdvancedHeader(e,"close"),e.addClass("mobile-size"),e.removeClass("desktop-size")):(e.hasClass("mobile-size")&&this.toggleAdvancedHeader(e,"open"),e.addClass("desktop-size"),e.removeClass("mobile-size"))},blockToggle:function(e){e.hasClass("hidden-block")?(e.parents(".ctdl-directory-search-form").addClass("filters-opened"),e.slideDown(300,(function(){e.removeClass("hidden-block")}))):e.slideUp(300,(function(){e.addClass("hidden-block"),e.parents(".ctdl-directory-search-form").removeClass("filters-opened")}))},applyToggle:function(e){var t=this;e.hasClass("advanced-header")&&e.find(".citadela-block-header").find(".header-toggle").on("click",(function(){t.toggleAdvancedHeader(e)}))},toggleAdvancedHeader:function(e,t=!1){var i=e.find(".citadela-block-articles"),a=e.find(".submit-button-wrapper");0==t?e.hasClass("opened")?(i.slideUp(300),a.slideUp(300),e.removeClass("opened")):(i.slideDown(300),a.slideDown(300),e.addClass("opened")):"open"!=t||e.hasClass("opened")?"close"==t&&e.hasClass("opened")&&(i.slideUp(300),a.slideUp(300),e.removeClass("opened")):(i.slideDown(300),a.slideDown(300),e.addClass("opened"))},applyCheckboxClick:function(e){var t=this;e.find(".data-row.type-checkbox, .data-row.type-select, .data-row.type-citadela_multiselect").each((function(){jQuery(this).find(".filter-container").on("click",null,(function(){var e=jQuery(this),i=e.find("input.filter-value").attr("name"),a=e.find("input.filter-value").attr("value");t.toggleFilter(jQuery(".ctdl-directory-advanced-filters").find(`input.filter-value[name=${i}][value=${a}]`))}))}))},toggleFilter:function(e){e.each((function(){var e=jQuery(this),t=e.parent(".filter-container");t.hasClass("selected")?(t.removeClass("selected"),e.attr("checked",!1)):(t.addClass("selected"),e.attr("checked",!0))}))},clearAllFilters:function(){var e=jQuery(".ctdl-directory-advanced-filters").find("input.filter-value");e.length&&e.each((function(){"checkbox"===jQuery(this).attr("type")&&(jQuery(this).parents(".filter-container").removeClass("selected"),jQuery(this).attr("checked",!1))}))},areSelectedFilters:function(){var e=jQuery(".ctdl-directory-advanced-filters").find("input.filter-value"),t=!1;return e.length&&e.each((function(){"checkbox"===jQuery(this).attr("type")&&"checked"==jQuery(this).attr("checked")&&(t=!0)})),t},applySubmitButtonClick:function(e){var t=this;e.find(".submit-button a").on("click",null,(function(){t.applyFilters(jQuery(this).get(0))}))},applyFilters:function(e,t=!1,a={}){var n=jQuery(".ctdl-directory-advanced-filters").find("input.filter-value"),r=[];if(n.length){var o=["a_filters","filters"];n.each((function(){var e=jQuery(this).attr("name"),t=jQuery(this).attr("value");-1===jQuery.inArray(e,o)&&o.push(e),"checkbox"===jQuery(this).attr("type")&&"checked"===jQuery(this).attr("checked")&&(t==e?(r.filters===i&&(r.filters=[]),-1===jQuery.inArray(t,r.filters)&&r.filters.push(t)):(r[e]===i&&(r[e]=[]),-1===jQuery.inArray(t,r[e])&&r[e].push(t)))}));var l=[];for(var c in Object.keys(r).length&&(l.a_filters=!0),r)r.hasOwnProperty(c)&&(l[c]=r[c].join(","));var d=window.location.pathname,s=(window.location.protocol,window.location.host,window.location.protocol+"//"+window.location.host+d),u=""!=window.location.search?window.location.search.replace("?","").split("&"):{},f={};jQuery.each(u,(function(e,t){var i=t.split("=");-1===jQuery.inArray(i[0],o)&&(void 0===i[1]?f[i[0]]="":f[i[0]]=decodeURIComponent(i[1]))})),t?(f.ctdl="true",f.post_type="citadela-item",f.s="",f.category="",f.location="",a.keyword&&(f.s=a.keyword),a.category&&(f.category=a.category),a.location&&(f.location=a.location),a.geoEnabled?(f.lat=a.lat?a.lat:"",f.lon=a.lon?a.lon:"",f.rad=a.rad,f.unit=a.unit):(delete f.lat,delete f.lon,delete f.rad,delete f.unit),s=jQuery(e).parents("form.search-form").attr("action")):(s=jQuery(e).data("action"),"taxonomy"!==jQuery(e).data("source")&&(f.ctdl||(f.ctdl="true"),f.post_type||(f.post_type="citadela-item"),f.s||(f.s=""),f.category||(f.category=""),f.location||(f.location="")));var p=jQuery.extend({},f,l),h=decodeURIComponent(jQuery.param(p));window.location.href=s+(h?"?"+h:"")}}};if(jQuery(".single-citadela-item .item-reviews").length){var o=jQuery(".single-citadela-item .item-reviews");l(o),function(e){var t=e.find("#cancel-comment-reply-link");t.off("click"),t.on("click",(function(){d(e),function(e){e.find("form.comment-form").prepend(c),c.append('<div class="rating"></div>'),l(e)}(e);var t=e.find("#submit-review-button");t.attr("value",t.data("submit-review-text"))}))}(o),function(e){e.find(".item_review").find(".comment-reply-link").each((function(){jQuery(this).off("click"),jQuery(this).on("click",(function(){d(e),function(e){var t=e.find(".rating-wrapper");(c=null===c?t.clone(!0):c).find("div.rating").remove(),t.remove()}(e);var t=e.find("#submit-review-button");t.attr("value",t.data("submit-reply-text"))}))}))}(o),function(e){e.find("#commentform #submit-review-button").on("click",(function(t){t.preventDefault(),d(e);var i=jQuery(this).parents("#commentform"),a=!0,n=i.find("input[name=rating]"),r=n.val();n.length&&!r&&(i.find(".rating-notification").show(200),a=!1);var o=i.find("textarea#comment");"required"==o.attr("required")&&""==o.val()&&(i.find(".general-notification").show(200),a=!1);var l=i.find("input#author");l.length&&"required"==l.attr("required")&&""==l.val()&&(i.find(".general-notification").show(200),a=!1);var c=i.find("input#email");c.length&&"required"==c.attr("required")&&(""==c.val()?(i.find(".general-notification").show(200),a=!1):/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(c.val())||(i.find(".email-notification").show(200),a=!1)),a?(i.submit(),d(e)):i.addClass("validation-failed")}))}(o)}function l(e){e.find(".comment-respond").find(".rating").raty({starType:"i",hints:["","","","",""],scoreName:"rating",click:function(e){jQuery(this).parents("#commentform").find(".rating-notification").hide(100)}})}var c=null;function d(e){e.find("#commentform").removeClass("validation-failed"),e.find(".citadela-notification").each((function(){jQuery(this).hide(100)}))}t.ready((function(){var e=r.init();citadela=jQuery.extend(citadela,{advanced_filters:e})}))}(jQuery,jQuery(document));