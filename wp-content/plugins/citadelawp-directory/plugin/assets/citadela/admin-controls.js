var citadela=citadela||{};function gm_authFailure(){var e=document.createElement("div"),t=document.createElement("a"),i=document.createTextNode("Read more");t.appendChild(i),t.title="Read more",t.href="https://www.ait-themes.club/how-to-get-google-maps-api-key/",t.target="_blank",e.className="alert alert-info";var a=document.createTextNode("Please check Google API key settings");e.appendChild(a),e.appendChild(document.createElement("br")),e.appendChild(t),jQuery(".citadela-google-map.google-map-container").html(e)}citadela.controls=citadela.controls||{},function(e,t,i,a){"use strict";var n="undefined"==typeof CitadelaDirectorySettings?{}:CitadelaDirectorySettings;citadela=jQuery.extend(citadela,n);var r=jQuery("#wpbody"),o=citadela.controls.ui={gpxMapObject:{provider:"",map:{},markers:[],polylines:[]},init:function(){o.enhancedInputs(r.find(".citadela-control, .citadela-user-settings, form#edittag, form#addtag"))},enhancedInputs:function(e){o.map(e),o.gpxUploader(e),jQuery.fn.colorpicker!==a&&o.colorpicker(e),o.image(e),o.fontawesomeSelect(e),o.itemExtension(e),o.repeaterControl(e),o.featuredCategorySelectControl(e),o.galleryControl(e)},galleryControl:function(e){var t=jQuery(".citadela_gallery-control",e);t.on("citadelaGalleryInputInit",null,(function(){var e=jQuery(this);({container:null,galleryWrapper:null,addButton:null,mediaFrame:null,init(){let t=this;t.container=e,t.galleryWrapper=e.find(".gallery-images"),t.addButton=e.find("input.add-media"),t.addButton.on("click",(function(){jQuery(this),t.addImages()})),t.applySortable(),t.applyDeletion()},addImages(){let e=this;e.mediaFrame||(e.mediaFrame=wp.media({multiple:"add",library:{type:"image"}}),e.mediaFrame.on("select",(function(){e.mediaFrame.state().get("selection").toJSON().forEach((t=>{const i=t.id;let a="";if(a=t.sizes&&t.sizes.thumbnail?t.sizes.thumbnail.url:t.url,a&&t.type&&"image"==t.type){const t=e.galleryWrapper.find(".image-wrapper").length+1,n=e.galleryWrapper.data("caption-label");let r=jQuery(`<div class="image-wrapper ui-sortable-handle">\n\t\t\t\t\t\t\t\t\t\t\t<div class="image">\n\t\t\t\t\t\t\t\t\t\t\t\t<input type="hidden" name="butterbean_citadela_item_options_setting__citadela_gallery_images[${t}][id]" value="${i}">\n\t\t\t\t\t\t\t\t\t\t\t\t<img src="${a}">\n\t\t\t\t\t\t\t\t\t\t\t\t<div class="caption">\n\t\t\t\t\t\t\t\t\t\t\t\t\t<label>${n}</label>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<input type="text" name="butterbean_citadela_item_options_setting__citadela_gallery_images[${t}][caption]" value="">\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class="delete"></div>\n\t\t\t\t\t\t\t\t\t\t</div>`);e.galleryWrapper.append(r),e.applyDeletion(r)}}))}))),e.mediaFrame.open()},applyDeletion(e=null){e?e.find(".delete").on("click",(function(){e.remove()})):this.container.find(".image-wrapper").each((function(){let e=jQuery(this);e.find(".delete").on("click",(function(){e.remove()}))}))},applySortable(){this.galleryWrapper.sortable({items:".image-wrapper",tolerance:"pointer",handle:".image"})}}).init()})),t.trigger("citadelaGalleryInputInit")},featuredCategorySelectControl:function(e){var t=jQuery(".citadela_featured_category_select-control",e);t.on("citadelaFeaturedCategorySelectInit",null,(function(){var e=jQuery(this);({container:null,valueInput:null,init(){let t=this;t.container=e,t.valueInput=e.find(".selected-term"),t.applyTermsClick(),t.applyCategoryCheckboxClick(),jQuery(document).ajaxSuccess((function(e,i,a){"add-citadela-item-category"==a.action&&t.addedNewCategory()})),t.checkNotification()},applyTermsClick(){let e=this;e.container.find(".term-wrapper").each((function(){e.applyTermWrapperClick(jQuery(this))}))},applyTermWrapperClick(e){var t=this;e.off("click"),e.on("click",(function(){t.toggleSelect(jQuery(this))}))},toggleSelect(e){let t=this;e.hasClass("selected")?(t.clearSelected(),t.setTerm(e)):(t.clearSelected(),e.addClass("selected"),t.setTerm(e))},setTerm(e){e.hasClass("selected")?this.valueInput.val(e.data("term_id")):this.valueInput.val("")},clearSelected(){this.container.find(".term-wrapper").removeClass("selected")},applyCategoryCheckboxClick(){let e=this;jQuery("#citadela-item-categorychecklist").find('input[name="tax_input[citadela-item-category][]"]').each((function(){e.categoryCheckboxClickEvent(jQuery(this))}))},categoryCheckboxClickEvent(e){var t=this;e.on("click",(function(){var e=jQuery(this).val();if(jQuery(this).prop("checked")){if(!t.container.find(`.term-wrapper.term-${e}`).length){var i="",n=[],r=citadela.itemCategoryTerms[e];r==a?i=jQuery(this).parent().text():(i=r.term_name,n.category_icon=r.term_meta.category_icon,n.category_color=r.term_meta.category_color),t.addNewTermWrapper(e,i,n)}}else t.removeTermWrapper(e)}))},addedNewCategory(){let e=this;var t=jQuery("#citadela-item-categorychecklist").find('input[name="tax_input[citadela-item-category][]"]').first(),i=t.val(),a=t.parent().text();e.container.find(`.term-wrapper.term-${i}`).length||(e.categoryCheckboxClickEvent(t),e.addNewTermWrapper(i,a))},addNewTermWrapper(e,t,i=[]){var n=this,r=n.getWrapperTemplate();r=(r=(r=(r=(r=r.replace(/{term_id}/g,e)).replace("{term_name}",t.trim())).replace("{category_icon}",i.category_icon!=a?i.category_icon:"fas fa-circle")).replace("{category_color}",i.category_color!=a?i.category_color:"#0085ba")).replace("{selected_class}",e==n.valueInput.val()?"selected":"");var o=jQuery(r);n.container.find(".input-wrapper").append(o),n.applyTermWrapperClick(o),n.checkNotification()},removeTermWrapper(e){this.container.find(`.term-wrapper.term-${e}`).remove(),this.checkNotification()},checkNotification(){var e=this;e.container.find(".term-wrapper").length?e.hideNotification():e.showNotification()},showNotification(){this.container.find(".no-posts-notification").show()},hideNotification(){this.container.find(".no-posts-notification").hide()},getWrapperTemplate(){return this.container.find("script.featured-category-select-control-template").html()}}).init()})),t.trigger("citadelaFeaturedCategorySelectInit")},itemExtension:function(e){var t=jQuery(".citadela-item-extension-inputs",e),i=t;t.on("itemExtensionInputTypeChange",null,(function(){var e=jQuery(this);e.find(".input-settings-wrapper"),e.find("select.type-input").each((function(e){var t=jQuery(this);t.off("change"),t.on("change",(function(e){var t=jQuery(this).parents(".input-settings-wrapper"),a=t;switch(jQuery(this).val()){case"select":[".input-choices",".choices-label",".filter-settings"].map(((e,i)=>{t.find(e).slideDown(300)})),[".input-filters-group-name",".url-settings",".number-settings"].map(((e,i)=>{t.find(e).slideUp(300)}));break;case"citadela_multiselect":[".input-choices",".filter-settings"].map(((e,i)=>{t.find(e).slideDown(300)})),[".choices-label",".input-filters-group-name",".url-settings",".number-settings"].map(((e,i)=>{t.find(e).slideUp(300)}));break;case"citadela_number":[".number-settings"].map(((e,i)=>{t.find(e).slideDown(300)})),[".choices-label",".input-filters-group-name",".url-settings",".input-choices",".filter-settings"].map(((e,i)=>{t.find(e).slideUp(300)}));break;case"citadela_url":[".url-settings"].map(((e,i)=>{t.find(e).slideDown(300)})),[".choices-label",".input-filters-group-name",".input-choices",".filter-settings",".number-settings"].map(((e,i)=>{t.find(e).slideUp(300)}));break;case"checkbox":[".filter-settings"].map(((e,i)=>{t.find(e).slideDown(300)})),[".input-choices",".choices-label",".url-settings",".number-settings"].map(((e,i)=>{t.find(e).slideUp(300)})),t.find("input.use-as-filter-input").prop("checked")?(t.find(".input-filters-group-name").slideDown(300),t.find(".input-filters-group-name").find(".filters-group-name-input").attr("required",!0)):(t.find(".input-filters-group-name").slideUp(300),t.find(".input-filters-group-name").find(".filters-group-name-input").attr("required",!1));break;default:[".input-choices",".choices-label",".url-settings",".number-settings",".filter-settings",".input-filters-group-name"].map(((e,i)=>{t.find(e).slideUp(300)})),t.find(".input-filters-group-name").find(".filters-group-name-input").attr("required",!1)}var n=i.data("repeaterControl");n.applyRequiredFieldsValidation(a),n.checkForRequiredFieldsValidationErrors(a)}))}))})),t.trigger("itemExtensionInputTypeChange"),i.on("citadelaRepeaterUpdateEvents",(function(e,n){n===a&&(n=t.find(".repeater-row")),n.each((function(){var e=jQuery(this).find("input.use-as-filter-input");e.off("change"),e.on("change",(function(){var e=jQuery(this).parents(".input-settings-wrapper"),t=e.find(".input-filters-group-name"),a=e.find("select.type-input").val();jQuery(this).prop("checked")&&"checkbox"==a?(t.slideDown(300),t.find(".filters-group-name-input").attr("required",!0)):(t.slideUp(300),t.find(".filters-group-name-input").attr("required",!1)),i.data("repeaterControl").checkForRequiredFieldsValidationErrors(n)}))}))})),jQuery(document.body).on("citadelaRepeaterItemAdded",(function(e,i){t.trigger("itemExtensionInputTypeChange"),-1!==jQuery.inArray(i.find("select.type-input").val(),["select","citadela_multiselect"])?i.find(".setting.input-choices").show():(i.find(".setting.input-choices").hide(),i.find(".setting.input-choices").find("textarea").val("")),"citadela_number"==i.find("select.type-input").val()?i.find(".settings-group.number-settings").show():(i.find(".settings-group.number-settings").hide(),i.find(".settings-group.number-settings").find(".min-input").val(""),i.find(".settings-group.number-settings").find(".max-input").val(""),i.find(".settings-group.number-settings").find(".unit-input").val(""),i.find(".settings-group.number-settings").find(".unit-position-input").val("right")),"citadela_url"==i.find("select.type-input").val()?i.find(".settings-group.url-settings").show():(i.find(".settings-group.url-settings").hide(),i.find(".settings-group.url-settings").find(".use-url-label-input").prop("checked",!1)),-1!==jQuery.inArray(i.find("select.type-input").val(),["citadela_multiselect","citadela_number","checkbox","select"])?i.find(".settings-group.filter-settings").show():(i.find(".settings-group.filter-settings").hide(),i.find(".settings-group.filter-settings").find(".filter-input").prop("checked",!1))}))},repeaterControl:function(e){var t=jQuery(".citadela-repeater-control",e);t.on("citadelaRepeaterInit",null,(function(){var e=jQuery(this);e.on("citadelaRepeaterNameUpdated",(function(e,t,i){t.find(".heading .part-title").html(i.val())})),{init(){let t=this;t.applyAddNewRowAction(),t.applySortable(),e.on("citadelaRepeaterUpdateEvents",(function(e,i){t.applyDuplicateRowAction(i||null),t.applyRemoveActions(i||null),t.applyNameKeyPairs(i||null),t.applyCollapse(i||null),t.applyRequiredFieldsValidation(i||null)})),e.trigger("citadelaRepeaterUpdateEvents"),e.data("repeaterControl",t)},applyDuplicateRowAction(i=null){let a=this;(t=i||e).find(".repeater-duplicate-button").each((function(){jQuery(this).on("click",(function(){a.duplicateInput(jQuery(this).parents(".repeater-row"))}))}))},applyAddNewRowAction(){let t=this;e.find(".repeater-add-button").on("click",(function(i){var a=e.find(".citadela-repeater-template").html(),n=jQuery(a);t.addNewInput(n)}))},applyRemoveActions(i=null){(t=i||e).find(".remove-button").each((function(e){jQuery(this).show(),jQuery(this).on("click",(function(){o.removeNode(jQuery(this).parents(".repeater-row"))}))}))},addNewInput(t){let i=this;e.find(".repeater-inputs").append(t),t.find(".repeater-input").each((function(e,t){var a=jQuery(t),n=a.prop("tagName").toLowerCase();const r=i.getNewInputName(jQuery(this));jQuery(this).attr("name",r),jQuery(this).attr("id",r),"select"===n?a.find("option").first().prop("selected",!0):("input"===n||"textarea"===n)&&a.val("")})),i.openRow(t),e.trigger("citadelaRepeaterUpdateEvents",[t]),jQuery(document.body).trigger("citadelaRepeaterItemAdded",[t])},duplicateInput(t){let i=this;var a=t.clone();t.after(a),a.find(".repeater-input").each((function(e,n){var r=jQuery(n);r.prop("tagName").toLowerCase();const l=i.getNewInputName(jQuery(this));if(jQuery(this).attr("name",l),jQuery(this).attr("id",l),r.hasClass("pair-key-input")&&""!=r.val()){var p=i.getReservedIdentifiers(r.parents(".citadela-repeater-control"));r.val(o.sanitizeIdentifier(r.val()+"_2",p))}t.find("select").each((function(e){a.find("select").eq(e).val(jQuery(this).val())}))})),e.trigger("citadelaRepeaterUpdateEvents",[a]),jQuery(document.body).trigger("citadelaRepeaterItemAdded",[a])},getNewInputName(t){var i=parseInt(e.find(".repeater-row").length);return t.data("id-schema").replace("{citadela_input_key}",`input_${i+1}`)},checkMinimalRows(){e.find(".repeater-row").length-1==1?e.find(".repeater-row .remove-button").hide():e.find(".repeater-row .remove-button").show()},applyNameKeyPairs(i=null){let a=this;(t=i||e.find(".repeater-row")).each((function(t){var i=jQuery(this),n=jQuery(this).find(".pair-name-input"),r=jQuery(this).find(".pair-key-input");n.on("blur",(function(t){var n=jQuery(this);if(jQuery(e).trigger("citadelaRepeaterNameUpdated",[i,n]),""==r.val()){var l=a.getReservedIdentifiers(n.parents(".citadela-repeater-control")),p=n.val();r.val(o.sanitizeIdentifier(p,l))}})),r.on("blur",(function(e){var t=jQuery(this),i=a.getReservedIdentifiers(n.parents(".citadela-repeater-control")),r=n.val();""==t.val()?t.val(o.sanitizeIdentifier(r,i)):i.filter((e=>e===t.val())).length>1?t.val(o.sanitizeIdentifier(t.val(),i)):t.val(o.sanitizeIdentifier(t.val()))}))}))},getReservedIdentifiers(e){var t=[];return e.find("input.pair-key-input").each((function(){var e=jQuery(this).val();""!==e&&t.push(e)})),t},applyRequiredFieldsValidation(i=null){let a=this;(t=i||e.find(".repeater-row")).each((function(){var e=jQuery(this);e.find(".repeater-input").each((function(){var t=jQuery(this);t.attr("required")&&t.on("blur",(function(){a.checkForRequiredFieldsValidationErrors(e)}))}))}))},validateRequiredInputs(i=null){(t=i||e.find(".repeater-row")).each((function(){jQuery(this).find(".repeater-input").each((function(){var e=jQuery(this);e.attr("required")&&""==e.val()?jQuery(this).addClass("validation-failed"):jQuery(this).removeClass("validation-failed")}))}))},checkForRequiredFieldsValidationErrors(i=null){let a=this;(t=i||e.find(".repeater-row")).each((function(){var e=jQuery(this);a.validateRequiredInputs(e),e.find(".validation-failed").length?e.find(".part-validation-message").show():e.find(".part-validation-message").hide()}))},applyCollapse(i=null){let a=this;(t=i||e.find(".repeater-row")).each((function(){var e=jQuery(this),t=jQuery(this).find(".handle");jQuery(this).find(".content"),t.on("click",(function(t){e.hasClass("closed")?a.openRow(e):a.closeRow(e)}))}))},openRow(e){e.find(".content").slideDown(300),e.removeClass("closed")},closeRow(e){e.find(".content").slideUp(300),e.addClass("closed"),this.checkForRequiredFieldsValidationErrors(e)},applySortable(){e.sortable({items:".repeater-row",handle:".handle",delay:150})}}.init()})),t.trigger("citadelaRepeaterInit")},fontawesomeSelect:function(e){var t=jQuery(".citadela-fontawesome-select-container",e);t.on("fontawesomeSelectinit",null,(function(){var e=jQuery(this),t=e.find(".selected-icon"),i=e.find("input.iconpicker"),a=e.find(".iconpicker-holder"),n=i.val();i.ctdlIconpicker({selected:n}),e.find(".iconpicker-item").on("click",(function(e){e.preventDefault(),t.find("i").attr("class",i.val()),a.removeClass("opened").slideUp()})),t.on("click",(function(e){e.preventDefault(),a.hasClass("opened")?a.removeClass("opened").slideUp():(a.addClass("opened").slideDown(),a.find(".iconpicker-search").focus())}))})),t.trigger("fontawesomeSelectinit")},image:function(e){var t=jQuery(".citadela-control-image",e);t.on("imageinit",null,(function(){if("undefined"!=typeof wp&&wp.media&&wp.media.editor){var e,t=jQuery(this),i=t.find("input.image-url"),a=t.find(".citadela-image-preview-container"),n=t.find(".citadela-delete-image-button");n.on("click",(function(e){return e.preventDefault(),i.val(""),a.html(""),n.hide(),!1})),t.find(".citadela-select-image-button").on("click",(function(t){t.preventDefault();var r=jQuery(this);return(e=wp.media.frames.file_frame=wp.media({multiple:!1})).on("select",(function(){r.blur();var t=e.state().get("selection").first().toJSON(),o=t.url;"id"==i.data("saveas")&&(o=t.id),i.val(o),a.html('<img src="'+t.url+'">'),n.show()})),e.open(),!1}))}})),t.trigger("imageinit")},colorpicker:function(e){var t=jQuery(".citadela-control-colorpicker",e);t.on("colorpickerinit",null,(function(){jQuery(this).find(".citadela-colorpicker-container").colorpicker()})),t.trigger("colorpickerinit")},map:function(e){var t=jQuery(".citadela_map-control",e);"openstreetmap"==t.data("map-provider")?o.openstreetMap(t):o.googleMap(t)},googleMap:function(e){e.on("mapinit",null,(function(){var e=jQuery(this),t=e.find(".google-map-container"),i=e.find("input.address-input"),a=e.find("input.search-button"),n=e.find("input.latitude-input"),r=e.find("input.longitude-input"),o=e.find("input.streetview-input"),l=e.find("input.swheading-input"),p=e.find("input.swpitch-input"),s=e.find("input.swzoom-input"),c=e.find(".citadela-google-map-message"),d={address:i.val(),latitude:n.val()?parseFloat(n.val()):1,longitude:r.val()?parseFloat(r.val()):1,streetview:o.prop("checked"),swheading:l.val()?parseFloat(l.val()):0,swpitch:p.val()?parseFloat(p.val()):0,swzoom:s.val()?parseFloat(s.val()):0},u=new google.maps.LatLng(d.latitude,d.longitude);t.height(300),t.css("width","100%");var g=new google.maps.Map(t.get(0),{center:u,zoom:17,mapTypeId:google.maps.MapTypeId.ROADMAP,streetViewControl:!1}),f=new google.maps.StreetViewPanorama(t.get(0),{position:u,pov:{heading:d.swheading,pitch:d.swpitch},zoom:d.swzoom}),m=new google.maps.Marker({map:g,position:u,draggable:!0}),h=new google.maps.Geocoder;g.addListener("click",(function(e){g.panTo({lat:e.latLng.lat(),lng:e.latLng.lng()}),m.setPosition(e.latLng),n.val(e.latLng.lat()),r.val(e.latLng.lng())})),m.addListener("drag",(function(){var e=m.getPosition();n.val(e.lat()),r.val(e.lng())})),m.addListener("dragend",(function(){var e=m.getPosition();g.panTo({lat:e.lat(),lng:e.lng()})})),f.addListener("position_changed",(function(){n.val(f.getPosition().lat()),r.val(f.getPosition().lng())})),f.addListener("pov_changed",(function(){l.val(f.getPov().heading),p.val(f.getPov().pitch),s.val(f.getPov().zoom)})),a.click((function(e){e.preventDefault(),c.slideUp();var t=i.val();t&&t.length&&h.geocode({address:t},(function(e,t){"OK"===t?(g.setCenter(e[0].geometry.location),m.setPosition(e[0].geometry.location),f.setPosition(e[0].geometry.location),n.val(e[0].geometry.location.lat()),r.val(e[0].geometry.location.lng()),n.trigger("keyup"),r.trigger("keyup")):c.slideDown()}))})),n.on("keyup",(function(e){jQuery(this).css({"border-color":""}),jQuery(this).parent().find("i").remove(),""!==jQuery(this).val()&&jQuery(this).val().match(/^-?\d*(\.\d+)?$/)&&jQuery(this).val()>=-90&&jQuery(this).val()<=90?jQuery(this).parent().append('<i class="fa fa-check-circle" style="color: #88B44E"></i>'):(jQuery(this).css({"border-color":"#BE6565"}),jQuery(this).parent().append('<i class="fa fa-times-circle" style="color: #BE6565"></i>'))})).trigger("keyup"),r.on("keyup",(function(e){jQuery(this).css({"border-color":""}),jQuery(this).parent().find("i").remove(),""!==jQuery(this).val()&&jQuery(this).val().match(/^-?\d*(\.\d+)?$/)&&jQuery(this).val()>=-180&&jQuery(this).val()<=180?jQuery(this).parent().append('<i class="fa fa-check-circle" style="color: #88B44E"></i>'):(jQuery(this).css({"border-color":"#BE6565"}),jQuery(this).parent().append('<i class="fa fa-times-circle" style="color: #BE6565"></i>'))})).trigger("keyup"),d.streetview?"function"==typeof f.setVisible&&f.setVisible(!0):"function"==typeof f.setVisible&&f.setVisible(!1),o.change((function(){o.prop("checked")?"function"==typeof f.setVisible&&f.setVisible(!0):"function"==typeof f.setVisible&&f.setVisible(!1)}))})),e.trigger("mapinit"),jQuery(".butterbean-nav").find("li").on("click",(function(){jQuery(".citadela_map-control").find(".google-map-container").each((function(){var e=jQuery(this).get(0);google.maps.event.trigger(e,"resize")}))}))},openstreetMap:function(t){var i=null;t.on("mapinit",null,(function(){var t=jQuery(this),a=t.find(".google-map-container"),n=t.find("input.address-input"),r=t.find("input.search-button"),o=t.find("input.latitude-input"),l=t.find("input.longitude-input"),p=t.find("input.streetview-input"),s=t.find(".citadela-google-map-message"),c={address:n.val(),latitude:o.val()?parseFloat(o.val()):1,longitude:l.val()?parseFloat(l.val()):1},d=L.latLng(c.latitude,c.longitude);a.height(300),a.css("width","100%"),p.attr("disabled",!0),i=L.map(a.get(0)),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png?",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'}).addTo(i),i.on("load",(function(e){setTimeout((function(){i.invalidateSize()}),300)})),i.setView(d,17);var u=L.marker(d,{draggable:!0,autoPan:!0}).addTo(i);i.on("click",(function(e){i.panTo(e.latlng),u.setLatLng(e.latlng),o.val(e.latlng.lat),l.val(e.latlng.lng)})),u.on("move",(function(e){o.val(e.latlng.lat),l.val(e.latlng.lng)})),u.on("moveend",(function(e){i.panTo(e.target.getLatLng())})),r.click((function(t){t.preventDefault(),s.slideUp();var a=n.val();a&&a.length&&e.getJSON("https://nominatim.openstreetmap.org/search?format=json&limit=1&q="+a,(function(e){if(0!=e.length){var t=e[0],a=L.latLng(t.lat,t.lon);i.panTo(a),u.setLatLng(a),o.val(t.lat),l.val(t.lon)}else s.slideDown()}))})),o.on("keyup",(function(e){jQuery(this).css({"border-color":""}),jQuery(this).parent().find("i").remove(),""!==jQuery(this).val()&&jQuery(this).val().match(/^-?\d*(\.\d+)?$/)&&jQuery(this).val()>=-90&&jQuery(this).val()<=90?jQuery(this).parent().append('<i class="fa fa-check-circle" style="color: #88B44E"></i>'):(jQuery(this).css({"border-color":"#BE6565"}),jQuery(this).parent().append('<i class="fa fa-times-circle" style="color: #BE6565"></i>'))})).trigger("keyup"),l.on("keyup",(function(e){jQuery(this).css({"border-color":""}),jQuery(this).parent().find("i").remove(),""!==jQuery(this).val()&&jQuery(this).val().match(/^-?\d*(\.\d+)?$/)&&jQuery(this).val()>=-180&&jQuery(this).val()<=180?jQuery(this).parent().append('<i class="fa fa-check-circle" style="color: #88B44E"></i>'):(jQuery(this).css({"border-color":"#BE6565"}),jQuery(this).parent().append('<i class="fa fa-times-circle" style="color: #BE6565"></i>'))})).trigger("keyup"),jQuery(".butterbean-nav").find("li").on("click",(function(){jQuery(".citadela_map-control").find(".google-map-container").each((function(){i.invalidateSize()}))}))})),t.trigger("mapinit")},gpxOpenstreetMap:function(t){var i=null;t.on("gpxmapinit",null,(function(){var t=e(this);o.gpxMapObject.provider="openstreetmap";var a=t.find(".map-container");a.height(300),a.css("width","100%"),i=L.map(a.get(0)),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png?",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'}).addTo(i),i.on("load",(function(e){setTimeout((function(){i.invalidateSize()}),300)})),o.gpxMapObject.map=i,o.drawGpxTrack(o.getGpxData(),i,"openstreetmap"),e(".butterbean-nav").find("li").on("click",(function(){e(".gpx-map-view").find(".map-container").each((function(){o.fitGpxMap()}))}))})),t.trigger("gpxmapinit")},removeGpxMarkers:function(){const t=o.gpxMapObject.markers,i=(o.gpxMapObject.map,o.gpxMapObject.provider);e.each(t,(function(e,t){"openstreetmap"==i&&t.remove()})),o.gpxMapObject.markers=[]},removeGpxTracks:function(){const t=o.gpxMapObject.polylines,i=(o.gpxMapObject.map,o.gpxMapObject.provider);e.each(t,(function(e,t){"openstreetmap"==i&&t.remove()})),o.gpxMapObject.polylines=[]},resetGpxMapData:function(){o.removeGpxMarkers(),o.removeGpxTracks()},fitGpxMap:function(){const e=o.gpxMapObject.provider,t=o.gpxMapObject.map;if("openstreetmap"==e){t.invalidateSize();let e=new L.featureGroup(o.gpxMapObject.markers.concat(o.gpxMapObject.polylines));t.fitBounds(e.getBounds())}},drawGpxTrack:function(t,i,a){o.resetGpxMapData();const n=t;e.each(n,((t,n)=>{let r=[];n.points&&!n.data&&(n.data=[],n.data.push(n.points)),n.data&&(n.data.forEach((e=>{let t=[];e.forEach((e=>{t.push([e.lat,e.lng])})),r.push(t)})),e.each(r,((t,n)=>{let r=[];if(e.each(n,((e,t)=>{r.push([t[0],t[1]])})),"openstreetmap"==a){var l=L.polyline(r,{color:"red"}).addTo(i);o.gpxMapObject.polylines.push(l)}})),o.addTrackMarkers(n))})),o.fitGpxMap()},addTrackMarkers:function(e){const t=o.gpxMapObject.map,i=o.gpxMapObject.provider,a=e.data,n=e.endpoints_type?e.endpoints_type:"track";let r=[],l=[],p=[];if("track"==n&&(l=a[0][0],p=a[a.length-1][a[a.length-1].length-1],r.push([[l.lat,l.lng],[p.lat,p.lng]])),"segments"==n&&a.forEach((e=>{l=e[0],p=e[e.length-1],r.push([[l.lat,l.lng],[p.lat,p.lng]])})),"none"==n||!r)return!1;if("openstreetmap"==i){const e="background-color: #007cba",i=`<div class="fa-map-label"><div style="${e}" class="fa-map-label-marker"></div><i class="fas fa-flag"></i></div>`,a=`<div class="fa-map-label"><div style="${e}" class="fa-map-label-marker"></div><i class="fas fa-flag-checkered"></i></div>`,n=`<div class="fa-map-label"><div style="${e}" class="fa-map-label-marker"></div><i class="far fa-flag"></i></div>`;let l=[];return r.forEach((e=>{const r=e[0],l=e[1];if(r[0]!==l[0]||r[1]!==l[1]){let e=L.divIcon({className:"citadela-marker-icon track-endpoint start-point",html:i,iconSize:[50,50],iconAnchor:[0,0]});const n=L.marker(r,{icon:e});n.addTo(t);let p=L.divIcon({className:"citadela-marker-icon track-endpoint end-point",html:a,iconSize:[50,50],iconAnchor:[0,0]});const s=L.marker(l,{icon:p});s.addTo(t),o.gpxMapObject.markers.push(n,s)}else{let e=L.divIcon({className:"citadela-marker-icon track-endpoint start-end-icon",html:n,iconSize:[50,50],iconAnchor:[0,0]});const i=L.marker(r,{icon:e});i.addTo(t),o.gpxMapObject.markers.push(i)}})),new L.featureGroup(l)}},getGpxData:function(){const t=e(".gpx-upload-control .gpx-track-input").val();return t?JSON.parse(t):[]},getGpxFileId:function(){return e(".gpx-upload-control .gpx-file-id-input").val()},gpxUploader:function(t){var i=e(".gpx-upload-control",t);i.on("gpxUploaderInit",null,(function(){var t=e(this),i=t.find(".gpx-map-view");({init(){let a=this;i.hasClass("load-map")?o.gpxOpenstreetMap(i):(i.hide(),l(".gpx-map-view",".citadela-file-uploader",(()=>a.reset())));const n="gpx"==t.find(".citadela-file-uploader").data("type")?_citadelaGpxUploadData:[];let r;t.find(".button-change-gpx-track").on("click",(e=>{e.preventDefault(),t.find(".uploader-cancel").show(),l(".gpx-map-view",".citadela-file-uploader",(()=>{}))})),t.find(".button-confirm-success").on("click",(e=>{e.preventDefault(),l(".citadela-file-uploader",".gpx-map-view",(()=>{a.reset(),o.fitGpxMap()}))})),t.find(".button-remove-gpx-track").on("click",(t=>{t.preventDefault(),e(".gpx-upload-control .gpx-track-input").val(""),e(".gpx-upload-control .gpx-file-id-input").val(""),o.gpxMapObject.polylines=[],l(".gpx-map-view",".citadela-file-uploader",(()=>a.reset()))})),t.find(".button-cancel").on("click",(t=>{t.preventDefault(),e(this).hide(),l(".citadela-file-uploader",".gpx-map-view",(()=>{a.reset(),o.fitGpxMap()}))})),t.find(".uploader-media-button").on("click",(function(t){return t.preventDefault(),r=wp.media.frames.file_frame=wp.media({multiple:!1,library:{type:"text/xml"}}),r.on("select",(function(){var t=r.state().get("selection").first().toJSON();e.post(CitadelaDirectorySettings.ajax.url+"?action=citadela_check_gpx_from_media",{attachment:t},(t=>{t.success?(a.poltergeistButton("hide"),a.processGpxData(t.data.data,t.data.file_id),l(".uploader",".import-complete")):(e(".uploader-error-title").text(t.data.title),e(".uploader-error-msg").html(t.data.message),l(".uploader-selector",".uploader-error"))}))})),r.open(),!1})),t.find(".gpx-endpoints-type").change((function(){const e=jQuery(this).find("option:selected").val();let i=t.find(".gpx-endpoints-type-description.selected"),a=t.find(`.gpx-endpoints-type-description.${e}-description`);l(i,a,(()=>{i.removeClass("selected"),a.addClass("selected")}));let n=o.getGpxData();n.forEach(((t,i)=>{n[i].endpoints_type=e}));const r=JSON.stringify(n);t.find(".gpx-track-input").val(r),o.resetGpxMapData(),o.drawGpxTrack(n,o.gpxMapObject.map,"openstreetmap")})),this.wpUploaderOptions=_.extend({init(){this.supports.dragdrop||e(".uploader").removeClass("drag-drop"),e(".uploader-error button").on("click",(()=>{l(".uploader-error",".uploader-selector")}))},added(e){l(".uploader-selector",".uploader-progress",(()=>a.onProgress(e)))},progress(e){a.onProgress(e)},success(e){a.onSuccess(e)},error(e,t,i){a.onError(t)},browser:e(".uploader-browse-button"),dropzone:e(".uploader")},n),new wp.Uploader(this.wpUploaderOptions)},onSuccess(e){this.poltergeistButton("hide"),this.processGpxData(e.get("data"),e.get("file_id")),l(".uploader",".import-complete")},onProgress(t){e(".uploader-cancel").hide(),e(".uploader-progress code").text(t.attributes.filename),e(".uploader-progress progress").val(t.attributes.percent)},onError(t){e(".uploader-error-title").text(t.title),e(".uploader-error-msg").html(t.message),l(".uploader-progress",".uploader-error")},reset(){this.poltergeistButton("show"),e(".uploader").show(),e(".uploader-selector").show(),e(".uploader-progress code").empty(),e(".uploader-progress progress").val(0),e(".uploader-progress").hide(),e(".uploader-error").hide(),e(".uploader-error-title").empty(),e(".uploader-error-msg").empty(),e(".import-complete").hide(),e(".uploader-cancel").hide()},poltergeistButton(t){e(".moxie-shim.moxie-shim-html5")[t]()},processGpxData(t,a){t.forEach(((i,a)=>{t[a].endpoints_type=e(".gpx-upload-control .gpx-endpoints-type").find("option:selected").val()}));const n=JSON.stringify(t);e(".gpx-upload-control .gpx-track-input").val(n),e(".gpx-upload-control .gpx-file-id-input").val(a),e.isEmptyObject(o.gpxMapObject.map)?o.gpxOpenstreetMap(i):(o.gpxMapObject.polyline=[],o.drawGpxTrack(o.getGpxData(),o.gpxMapObject.map,o.gpxMapObject.provider))}}).init()})),i.trigger("gpxUploaderInit")},sanitizeIdentifier:function(e,t=[]){var i={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",Æ:"AE",Ç:"C",È:"E",É:"E",Ê:"E",Ë:"E",Ì:"I",Í:"I",Î:"I",Ï:"I",Ð:"D",Ñ:"N",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",Ù:"U",Ú:"U",Û:"U",Ü:"U",Ý:"Y",ß:"s",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",æ:"ae",ç:"c",è:"e",é:"e",ê:"e",ë:"e",ì:"i",í:"i",î:"i",ï:"i",ñ:"n",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",ù:"u",ú:"u",û:"u",ü:"u",ý:"y",ÿ:"y",Ā:"A",ā:"a",Ă:"A",ă:"a",Ą:"A",ą:"a",Ć:"C",ć:"c",Ĉ:"C",ĉ:"c",Ċ:"C",ċ:"c",Č:"C",č:"c",Ď:"D",ď:"d",Đ:"D",đ:"d",Ē:"E",ē:"e",Ĕ:"E",ĕ:"e",Ė:"E",ė:"e",Ę:"E",ę:"e",Ě:"E",ě:"e",Ĝ:"G",ĝ:"g",Ğ:"G",ğ:"g",Ġ:"G",ġ:"g",Ģ:"G",ģ:"g",Ĥ:"H",ĥ:"h",Ħ:"H",ħ:"h",Ĩ:"I",ĩ:"i",Ī:"I",ī:"i",Ĭ:"I",ĭ:"i",Į:"I",į:"i",İ:"I",ı:"i",Ĳ:"IJ",ĳ:"ij",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",Ĺ:"L",ĺ:"l",Ļ:"L",ļ:"l",Ľ:"L",ľ:"l",Ŀ:"L",ŀ:"l",Ł:"l",ł:"l",Ń:"N",ń:"n",Ņ:"N",ņ:"n",Ň:"N",ň:"n",ŉ:"n",Ō:"O",ō:"o",Ŏ:"O",ŏ:"o",Ő:"O",ő:"o",Œ:"OE",œ:"oe",Ŕ:"R",ŕ:"r",Ŗ:"R",ŗ:"r",Ř:"R",ř:"r",Ś:"S",ś:"s",Ŝ:"S",ŝ:"s",Ş:"S",ş:"s",Š:"S",š:"s",Ţ:"T",ţ:"t",Ť:"T",ť:"t",Ŧ:"T",ŧ:"t",Ũ:"U",ũ:"u",Ū:"U",ū:"u",Ŭ:"U",ŭ:"u",Ů:"U",ů:"u",Ű:"U",ű:"u",Ų:"U",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",ź:"z",Ż:"Z",ż:"z",Ž:"Z",ž:"z",ſ:"s",ƒ:"f",Ơ:"O",ơ:"o",Ư:"U",ư:"u",Ǎ:"A",ǎ:"a",Ǐ:"I",ǐ:"i",Ǒ:"O",ǒ:"o",Ǔ:"U",ǔ:"u",Ǖ:"U",ǖ:"u",Ǘ:"U",ǘ:"u",Ǚ:"U",ǚ:"u",Ǜ:"U",ǜ:"u",Ǻ:"A",ǻ:"a",Ǽ:"AE",ǽ:"ae",Ǿ:"O",ǿ:"o"," ":"_","+":"_","'":"","?":"","!":"","/":"","\\":"",".":"",",":"","`":"",">":"","<":"",'"':"","[":"","]":"","|":"","{":"","}":"","(":"",")":""};if(e=(e=e.replace(/\W/g,(function(e){return i[e]!==a?i[e]:e}))).toLowerCase(),0!==t.length)for(;-1!==jQuery.inArray(e,t);)e+="_2";return e},removeNode(e){e.slideUp(300,(function(){e.remove()}))},isTouch:"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0};function l(t,i,a){e(t).fadeOut(100,(()=>{e(i).fadeIn(200,(()=>{a&&a()}))}))}i.ready((function(){citadela.controls.ui.init()}))}(jQuery,jQuery(window),jQuery(document));