!function(t,i,o){var r=function(t){this.value={h:1,s:1,b:1,a:1},this.setColor(t)};r.prototype={constructor:r,setColor:function(i){i=i.toLowerCase();var o=this;t.each(e.stringParsers,(function(t,r){var s=r.re.exec(i),a=s&&r.parse(s),l=r.space||"rgba";if(a)return o.value="hsla"===l?e.RGBtoHSB.apply(null,e.HSLtoRGB.apply(null,a)):e.RGBtoHSB.apply(null,a),!1}))},setHue:function(t){this.value.h=1-t},setSaturation:function(t){this.value.s=t},setLightness:function(t){this.value.b=1-t},setAlpha:function(t){this.value.a=parseInt(100*(1-t),10)/100,this.value.opacity=parseInt(100*(1-t),10)},toRGB:function(t,i,o,r){var s,e,a,l,h;return t||(t=this.value.h,i=this.value.s,o=this.value.b),t=(t*=360)%360/60,s=e=a=o-(h=o*i),s+=[h,l=h*(1-Math.abs(t%2-1)),0,0,l,h][t=~~t],e+=[l,h,h,l,0,0][t],a+=[0,0,l,h,h,l][t],void 0===r&&(r=void 0!==this.value.a?this.value.a:1),{r:Math.round(255*s),g:Math.round(255*e),b:Math.round(255*a),a:r,opacity:100*r}},toRGBAstring:function(){var t=this.toRGB();return"rgba("+t.r+", "+t.g+", "+t.b+", "+t.a+")"},toHex:function(t,i,o,r){var s=this.toRGB(t,i,o,r);return"#"+(1<<24|parseInt(s.r,10)<<16|parseInt(s.g,10)<<8|parseInt(s.b,10)).toString(16).substr(1)},toHSL:function(t,i,o,r){t||(t=this.value.h,i=this.value.s,o=this.value.b);var s=(2-i)*o,e=i*o;return(e/=s>0&&s<=1?s:2-s)>1&&(e=1),{h:t,s:e,l:s/=2,a:r||this.value.a||1,opacity:100*r||100*this.value.a||100}}};var s=function(i,o){var r=t(i);this.$input=r.find("input.citadela-colorpicker-color");var s=o.format||this.$input.data("color-format")||"hex";this.$opacityInput=r.find("input.citadela-colorpicker-opacity"),this.$storageInput=r.find("input.citadela-colorpicker-storage"),this.format=e.translateFormats[s],this.$colorPreview=r.find(".citadela-colorpicker-preview"),this.isRequired="1"==r.find("input.citadela-colorpicker-required").val(),this.$picker=t(e.template).appendTo("body").on("mousedown",t.proxy(this.mousedown,this)),this.$input.on({focus:t.proxy(this.show,this),blur:t.proxy(this.hide,this),keyup:t.proxy(this.update,this)}),this.$opacityInput.on({keyup:t.proxy(this.update,this,!0),click:t.proxy(this.update,this,!0)}),this.$colorPreview.on({click:t.proxy(this.show,this)}),"rgba"!==s&&"hsla"!==s||(this.$picker.addClass("alpha"),this.alpha=this.$picker.find(".colorpicker-alpha")[0].style),this.colorPreview=this.$colorPreview.find("i")[0].style,this.pickerColorPreview=this.$picker.find("div:last")[0].style,this.base=this.$picker.find("div:first")[0].style,this.update()};s.prototype={constructor:s,pointer:null,slider:null,show:function(r){this.$picker.show(),this.height=this.$input.outerHeight(),this.place(),i.on("resize",t.proxy(this.place,this)),o.on({mousedown:t.proxy(this.hide,this)}),this.$input.trigger({type:"show",color:this.color})},update:function(t){t=void 0!==t&&t,this.color=new r(this.$input.val());var i=this.$opacityInput.length&&""!==this.$opacityInput.val()?this.$opacityInput.val():100,o=parseInt(i,10)/100;this.color.value.a=o>1?1:Math.abs(o),this.color.value.opacity=100*this.color.value.a,t&&this.$storageInput.prop("value",this.format.call(this)),this.$input.trigger({type:"changeColor",color:this.color}),this.$picker.find("i").eq(0).css({left:100*this.color.value.s,top:100-100*this.color.value.b}).end().eq(1).css("top",100*(1-this.color.value.h)).end().eq(2).css("top",100*(1-this.color.value.a)),this.previewColor()},setValue:function(t){this.color=new r(t),this.$picker.find("i").eq(0).css({left:100*this.color.value.s,top:100-100*this.color.value.b}).end().eq(1).css("top",100*(1-this.color.value.h)).end().eq(2).css("top",100*(1-this.color.value.a)),this.previewColor(),this.$input.trigger({type:"changeColor",color:this.color})},hide:function(){this.$picker.hide(),i.off("resize",this.place),o.off({mousedown:this.hide}),""!==this.$input.val()?this.$storageInput.prop("value",this.format.call(this)):this.$storageInput.prop("value",this.isRequired?"rgba(255, 0, 0, 1)":""),this.$input.trigger({type:"hide",color:this.color})},place:function(){var t=this.$input.offset();this.$picker.css({top:t.top+this.height,left:t.left})},previewColor:function(){var t=""!==this.$input.val();try{this.pickerColorPreview.backgroundColor=this.format.call(this),this.colorPreview.backgroundColor=t?this.format.call(this):this.isRequired?"rgba(255, 0, 0, 1)":"transparent"}catch(i){this.pickerColorPreview.backgroundColor=this.color.toHex(),this.colorPreview.backgroundColor=t?this.color.toHex():this.isRequired?"#ff0000":"transparent"}this.base.backgroundColor=this.color.toHex(this.color.value.h,1,1,1),this.alpha&&(this.alpha.backgroundColor=this.color.toHex())},mousedown:function(i){i.stopPropagation(),i.preventDefault();var r=t(i.target).closest("div");if(!r.is(".colorpicker")){if(r.is(".colorpicker-saturation"))this.slider=t.extend({},e.sliders.saturation);else if(r.is(".colorpicker-hue"))this.slider=t.extend({},e.sliders.hue);else{if(!r.is(".colorpicker-alpha"))return!1;this.slider=t.extend({},e.sliders.alpha)}var s=r.offset();this.slider.knob=r.find("i")[0].style,this.slider.left=i.pageX-s.left,this.slider.top=i.pageY-s.top,this.pointer={left:i.pageX,top:i.pageY},o.on({mousemove:t.proxy(this.mousemove,this),mouseup:t.proxy(this.mouseup,this)}).trigger("mousemove")}return!1},mousemove:function(t){t.stopPropagation(),t.preventDefault();var i=Math.max(0,Math.min(this.slider.maxLeft,this.slider.left+((t.pageX||this.pointer.left)-this.pointer.left))),o=Math.max(0,Math.min(this.slider.maxTop,this.slider.top+((t.pageY||this.pointer.top)-this.pointer.top)));this.slider.knob.left=i+"px",this.slider.knob.top=o+"px",this.slider.callLeft&&this.color[this.slider.callLeft].call(this.color,i/100),this.slider.callTop&&this.color[this.slider.callTop].call(this.color,o/100),this.previewColor(),this.$input.val(this.color.toHex()),this.$opacityInput.val(this.color.value.opacity);try{this.$storageInput.val(this.format.call(this))}catch(t){this.$storageInput.val(this.color.toHex())}return this.$input.trigger({type:"changeColor",color:this.color}),!1},mouseup:function(t){return t.stopPropagation(),t.preventDefault(),o.off({mousemove:this.mousemove,mouseup:this.mouseup}),!1}},t.fn.colorpicker=function(i,o){return this.each((function(){var r=t(this),e=r.data("colorpicker"),a="object"==typeof i&&i;e||r.data("colorpicker",e=new s(this,t.extend({},t.fn.colorpicker.defaults,a))),"string"==typeof i&&e[i](o)}))},t.fn.colorpicker.defaults={},t.fn.colorpicker.Constructor=s;var e={translateFormats:{rgb:function(){var t=this.color.toRGB();return"rgb("+t.r+", "+t.g+", "+t.b+")"},rgba:function(){var t=this.color.toRGB();return"rgba("+t.r+", "+t.g+", "+t.b+", "+t.a+")"},hsl:function(){var t=this.color.toHSL();return"hsl("+Math.round(360*t.h)+", "+Math.round(100*t.s)+"%, "+Math.round(100*t.l)+"%)"},hsla:function(){var t=this.color.toHSL();return"hsla("+Math.round(360*t.h)+", "+Math.round(100*t.s)+"%, "+Math.round(100*t.l)+"%, "+t.a+")"},hex:function(){return this.color.toHex()}},sliders:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setLightness"},hue:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setHue"},alpha:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setAlpha"}},RGBtoHSB:function(t,i,o,r){var s,e;return t/=255,i/=255,o/=255,{h:((0==(e=(s=Math.max(t,i,o))-Math.min(t,i,o))?null:s==t?(i-o)/e:s==i?(o-t)/e+2:(t-i)/e+4)+360)%6*60/360||1,s:0===e?0:e/s,b:s,a:r||1}},HueToRGB:function(t,i,o){return o<0?o+=1:o>1&&(o-=1),6*o<1?t+(i-t)*o*6:2*o<1?i:3*o<2?t+(i-t)*(2/3-o)*6:t},HSLtoRGB:function(t,i,o,r){var s;i<0&&(i=0);var a=2*o-(s=o<=.5?o*(1+i):o+i-o*i),l=t+1/3,h=t,n=t-1/3;return[Math.round(255*e.HueToRGB(a,s,l)),Math.round(255*e.HueToRGB(a,s,h)),Math.round(255*e.HueToRGB(a,s,n)),r||1]},stringParsers:[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(t){return[t[1],t[2],t[3],t[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(t){return[2.55*t[1],2.55*t[2],2.55*t[3],t[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,parse:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,parse:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(t){return[t[1]/360,t[2]/100,t[3]/100,t[4]]}}],template:'<div class="colorpicker dropdown-menu"><div class="colorpicker-saturation"><i><b></b></i></div><div class="colorpicker-hue"><i></i></div><div class="colorpicker-alpha"><i></i></div><div class="colorpicker-color"><div /></div></div>'}}(jQuery,jQuery(window),jQuery(document));