jQuery(function(e){WP_Optimize_Premium=WP_Optimize_Premium()});var WP_Optimize_Premium=function(){function e(e,i,t){return i||(i={}),i.images_trash_command=e,L("images_trash_command",i,t)}function t(e){var i=U("#wp-optimize-wrap .nav-tab-wrapper .nav-tab-active").is(["#wp-optimize-nav-tab-",e].join(""));return i}function o(){Oe||(Oe=!0,ze.show(),ke.hide(),l(ve.DETECT_BOTH,!1,!0))}function s(e){De.hasOwnProperty(e)&&(De[e].abort(),delete De[e])}function n(t){return r(!0),t||(t=ze.get_selected_images()),ze.show_custom_loader(wpoptimize.moving_selected_unused_images_to_trash),e("move_images_to_trash",{images:t},function(e){alert(e.message),r(!1),ze.remove_selected_images(),ze.hide_loader();for(i in t)image_val=t[i],blog_id=image_val.split("_").shift(),Te[blog_id]--,Pe[blog_id]--;m(j()),ze.update_view(),ee.data("dirty",!0)})}function a(i,t){return r(!0),i||(i=ke.get_selected_images()),ke.show_custom_loader(wpoptimize.deleting_unused_images_from_trash),e("remove_trash_images",{images:i},function(e){e.error?alert(e.error):e.message&&(alert(e.message),t?(t.remove(),p(j(),-i.length)):ke.reload()),ke.hide_loader(),r(!1)})}function _(i,t){return r(!0),s(ve.DETECT_IMAGES),i||(i=ke.get_selected_images()),ke.show_custom_loader(wpoptimize.restoring_selected_unused_images_from_trash),e("restore_images_from_trash",{images:i},function(e){e.error?alert(e.error):e.message&&(alert(e.message),K.data("dirty",!0),t?t.remove():ke.remove_selected_images(),ke.load_next_page_if_need(),p(j(),-i.length)),ke.hide_loader(),r(!1)})}function p(e,i){Ie.hasOwnProperty(e)&&(Ie[e]+=i),Ce.hasOwnProperty(e)&&(Ce[e]+=i),h(e)}function d(e){Te={},Pe={},je={};var i={mode:ve.DETECT_IMAGES};e&&(i.forced=!0),ze.show_loader(),U(document).trigger(ye.GET_INFO_START,i),De[i.mode]=Z(U(".wpo-shade-progress-message"),"images",i).fail(function(){U(document).trigger(ye.GET_INFO_DONE,i)})}function r(e){var i=U("#optimization_checkbox_images");U.each([oe,ae,U("#optimization_button_images_big"),U("#optimization_button_images_small"),i,_e,se,te,ne,K,ee],function(i,t){t.prop("disabled",e)}),e?(Ee=i.is(":checked"),i.prop("checked",!1)):(i.prop("checked",Ee),ze.update_view(),ke.update_view())}function l(e,i,t){var o={mode:e};i&&(o.forced=i),t&&(o.quickinfo=t),U(document).trigger(ye.GET_INFO_START,o),De[e]=Z(U(".wpo-shade-progress-message"),"images",o).fail(function(){U(document).trigger(ye.GET_INFO_DONE,o),le.show()}).always(function(){delete De[e]})}function c(){var e=j(),i=Te.hasOwnProperty(e)?Te[e]:0;if(0!=i&&(!je.hasOwnProperty(e)||be.BUSY!==je[e]&&be.COMPLETE!==je[e])){U("#wpo_unused_images_loader_bottom").css("visibility","visible"),je[e]=be.BUSY;var t={optimization_id:"images",data:{mode:ve.DETECT_IMAGES,blog_id:e,length:xe,offset:i}};L("get_optimization_info",t,function(i){var t=b(i.result.meta);m(j()),t==xe?je[e]=be.SUCCESS:je[e]=be.COMPLETE,U("#wpo_unused_images_loader_bottom").css("visibility","hidden"),ze.update_view()}).fail(function(){je[e]=be.FAILURE,U("#wpo_unused_images_loader_bottom").css("visibility","hidden")})}}function u(){var i=j(),t=ke.get_images_count(i),o=ke.get_visible_images_count(i);if(!Se.hasOwnProperty(i)||be.BUSY!==Se[i]&&be.COMPLETE!==Se[i])return Se[i]=be.BUSY,U("#wpo_unused_images_loader_bottom").css("visibility","visible"),0==t&&(U(".wpo_shade",V).show(),U(".wpo-shade-progress-message").html(""),Ie[i]=0),e("get_trash_images",{offset:o,length:xe,blog_id:i},function(e){if(U("#wpo_unused_images_loader_bottom").css("visibility","hidden"),U(".wpo_shade",V).hide(),e.errors)return void alert(e.errors.join("\n"));var t,o,s,n;for(t in e.images)e.images.hasOwnProperty(t)&&(o=e.images[t][0],n=e.images[t].length>1?[e.images[t][0]," [id:",e.images[t][1]," ]"].join(""):e.images[t][0],s=[e.base_url,e.images[t][0]].join(""),ke.append_image(i,o,s,s,n,n),Ie.hasOwnProperty(i)||(Ie[i]=0),Ie[i]++);Ce[i]=e.total,h(j()),e.images&&e.images.length===xe?Se[i]=be.SUCCESS:Se[i]=be.COMPLETE,ke.update_view()})}function m(e){if(Pe.hasOwnProperty(e)&&Pe[e]>0){var i=wpoptimize.x_of_x_images_loaded.replace("%1$s",Te[e]).replace("%2$s",Pe[e]);U("#wpo_unused_images_loaded_count").text(i)}else U("#wpo_unused_images_loaded_count").text("")}function h(e){if(Ce.hasOwnProperty(e)){var i=wpoptimize.x_of_x_images_loaded.replace("%1$s",Ie[e]).replace("%2$s",Ce[e]);U("#wpo_unused_images_trash_loaded_count").text(i)}}function w(e){return!!(e.result&&e.result.hasOwnProperty("meta")&&e.result.meta)&&e.result.meta}function g(e,i){var t=w(e);t?i&&i(t):alert(wpoptimize.error_unexpected_response)}function f(e){var i=!e.hasOwnProperty("removed_message");i&&q.text("");var t=["last_scan_",ve.DETECT_IMAGES].join("");if(U(".wpo-last-scan-text",V).text(e[t]),e&&e.hasOwnProperty("unused_images")){var o,s="",n=!1,a=me.val();i&&b(e),me.html("");for(o in e.unused_images)e.unused_images.hasOwnProperty(o)&&(e.images_loaded_info.hasOwnProperty(o)&&(Pe[o]=e.images_loaded_info[o].total),e.multisite&&(n=!0,s=[e.sites[o].domain,e.sites[o].path].join(""),me.append(['<option value="',o,'">',s,0==e.unused_images[o].length?" ("+wpoptimize.no_unused_images+")":"","</option>"].join(""))))}e&&0===e.files&&(Pe[j()]=0,je[j()]=be.COMPLETE),n?(ue.show(),a&&me.val(a),y(me.val())):ue.hide(),m(j())}function v(e){var i=["last_scan_",ve.DETECT_SIZES].join("");U(".wpo-last-scan-text",X).text(e[i]),k(U("#registered_image_sizes"),z(e.image_sizes,"used",!0),wpoptimize.no_registered_image_sizes),k(U("#unused_image_sizes"),z(e.image_sizes,"used",!1),wpoptimize.no_unused_image_sizes),U("#registered_image_sizes, #unused_image_sizes").on("change",'input[type="checkbox"]',function(){C()}),C()}function b(e){var i,t,o=0,s="",n="",a="",_={};for(o in e.unused_images)if(e.unused_images.hasOwnProperty(o)){e.images_loaded_info.hasOwnProperty(o)&&(Pe[o]=e.images_loaded_info[o].total),s=e[["baseurl_",o].join("")],n=e[["adminurl_",o].join("")],t=0;for(i in e.unused_images[o])e.unused_images[o].hasOwnProperty(i)&&(t++,_=e.unused_images[o][i],e.multisite&&(a=[e.sites[o].domain,e.sites[o].path].join("")),O(_,s,n,o,a));Te.hasOwnProperty(o)?Te[o]+=t:Te[o]=t}return t}function y(e){ze.filter_by_site(e),ke.is_visible()&&ke.reload()}function z(e,i,t){var o,s=[];for(o in e)e.hasOwnProperty(o)&&e[o].hasOwnProperty(i)&&t==e[o][i]&&(s[o]=e[o]);return s}function k(e,i,t){var o,s=!0,n="wpo-original-unscaled";if(e.text(""),i){i.hasOwnProperty(n)&&e.append(['<label for="chk_',n,'" class="unused-image-sizes__label"><input type="checkbox" id="chk_',n,'" class="unused-image-sizes" name="',n,'">',wpoptimize.original_if_scaled_version_exist," (",i[n].size_formatted," - Total: ",i[n].files,")</lalbel><br>"].join(""));for(o in i)n!==o&&i.hasOwnProperty(o)&&(e.append(['<label for="chk_',o,'" class="unused-image-sizes__label"><input type="checkbox" id="chk_',o,'" class="unused-image-sizes" name="',o,'">',o," (",i[o].size_formatted," - Total: ",i[o].files,")</lalbel><br>"].join("")),s=!1)}s?(U(".hide_on_empty",e.parent()).hide(),e.append(["<i>",t,"</i>"].join(""))):U(".hide_on_empty",e.parent()).show()}function O(e,i,t,o,s){var n=[o,e.id?e.id:e.orig_url].join("_"),a=e.id?[t,"post.php?post=",e.id,"&action=edit"].join(""):[i,"/",e.url].join(""),_=e.id?["#",e.id].join(""):e.url,p=[i,"/",e.url].join(""),d=[i,"/",e.id&&e.url?e.url.replace(/(\-[0-9]+x[0-9]+)(\.[a-z]+)$/i,"$2"):e.url,e.id?[" [id: ",e.id,"]"].join(""):""].join("");s&&(_=[_," [",s,"]"].join("")),ze.append_image(o,n,a,p,_,d)}function E(e){ze.switch_view_mode(e),ke.switch_view_mode(e)}function T(){var e=[];e=0==U("#wpo_unused_images input:not(:checked)").length&&be.COMPLETE==je[j()]?"all":ze.get_selected_images(),0!=e.length&&P(e)}function P(e){return U(document).trigger(ye.OPTIMIZATION_START),ze.show_custom_loader(wpoptimize.deleting_selected_unused_images),L("do_optimization",{optimization_id:"images",data:{selected_images:e,images_loaded:Te}},function(i){var t,o,s,n;for(t in e)e.hasOwnProperty(t)&&(s=e[t],o=U(['#wpo_unused_images input[value="',s,'"'].join("")),n=s.split("_").shift(),Te[n]--,Pe[n]--,o.closest(".wpo_unused_image").remove());U(document).trigger(ye.OPTIMIZATION_DONE,i),ze.hide_loader(),ze.load_next_page_if_need()}).fail(function(){ze.hide_loader(),alert(wpoptimize.error_unexpected_response)})}function x(){var e=[];return U('#registered_image_sizes input[type="checkbox"], #unused_image_sizes input[type="checkbox"]').each(function(){var i=U(this);i.is(":checked")&&e.push(i.prop("name"))}),e}function I(){var e=x();if(!ae.prop("disabled")&&e&&0!=e.length){var i=U("#registered_image_sizes"),t=U("#unused_image_sizes"),o=i.parent(),s=U(".wpo_unused_images_loader",o);r(!0),s.show(),L("do_optimization",{optimization_id:"images",data:{selected_sizes:e}},function(e){g(e,function(e){k(i,z(e.image_sizes,"used",!0),wpoptimize.no_registered_image_sizes),k(t,z(e.image_sizes,"used",!1),wpoptimize.no_used_image_sizes)}),r(!1),C(),s.hide(),alert(e.result.meta.removed_message)}).fail(function(){r(!1),C(),s.hide(),alert(wpoptimize.error_unexpected_response)})}}function C(){var e=U("#registered_image_sizes"),i=U("#unused_image_sizes");U('input[type="checkbox"]:checked',e).length+U('input[type="checkbox"]:checked',i).length>0?ae.prop("disabled",!1):ae.prop("disabled",!0)}function j(){return me.length&&me.val()?me.val():1}function S(e){var i="";i=U("#wpo_lazy_load_settings input[type='text'], #wpo_lazy_load_settings input[type='radio']").serialize(),U.each(U("#wpo_lazy_load_settings input[type='checkbox']"),function(){var e=U(this).prop("checked")?"1":"0";i+="&"+U(this).attr("name")+"="+e}),L("save_lazy_load_settings",i,function(i){U("body").trigger("wpo_purge_cache"),e&&e(i)})}function D(e){var i=e.id,t=e.title,o=U("#wpo-popup-preview"),s=['<table id="wpo-preview-tablesorter" cellspacing="2" cellpadding="2" class="tablesorter"></table>','<h4 id="wpo-preview-message" style="display: none;"></h4>'].join(""),n=['<div id="pager" class="pager" style="display: none">','<span class="first dashicons dashicons-controls-skipback"></span>','<span class="prev dashicons dashicons-controls-back"></span>','<input type="text" class="pagedisplay">','<span class="pagedisplay-count"></span>','<span class="next dashicons dashicons-controls-forward"></span>','<span class="last dashicons dashicons-controls-skipforward"></span>','<select class="pagesize">','<option value="50">50</option>','<option value="100">100</option>','<option value="200">200</option>','<option value="300">300</option>','<option value="400">400</option>','<option value="500">500</option>',"</select>","</div>"].join(""),a="",_=[],p={};if("undefined"!=typeof wpoptimize.sites&&wpoptimize.sites.length){for(var d in wpoptimize.sites)wpoptimize.sites.hasOwnProperty(d)&&_.push(['<option value="',wpoptimize.sites[d].blog_id,'">',wpoptimize.sites[d].domain,wpoptimize.sites[d].path,"</option>"].join(""));a=['<select id="wpo-preview-site" style="display: none">',_.join(""),"</select>"].join("")}p[wpoptimize.delete_selected_items_btn]=function(){var t=[],o=U("#wpo-preview-tablesorter");if(U("input:checkbox:checked",o).each(function(){U(this).is("#wpo-select-all-preview-rows")||t.push(U(this).val())}),0!=t.length){var s=e;s.ids=t,U("#wpo-preview-site").length&&(s.site_id=U("#wpo-preview-site").val()),r.show(),wp_optimize.send_command("do_optimization",{optimization_id:i,data:s},function(e){U("#wpo-preview-tablesorter")[0].dispatchEvent(new CustomEvent("reload",{})),U("#wpo-select-all-preview-rows").prop("checked",!1),L("get_optimization_info",{optimization_id:i},function(e){var t=(e&&e.result&&e.result.meta?e.result.meta:{},e&&e.result&&e.result.output?e.result.output.join("<br>"):""),o={};if(""!=t){U(["#optimization_info_",i,' input[type="checkbox"]'].join("")).each(function(){o[U(this).attr("name")]=U(this).prop("checked")}),U(["#optimization_info_",i].join("")).html(t);for(var s in o)o.hasOwnProperty(s)&&U(["#optimization_info_",i,' input[name="',s,'"]'].join("")).prop("checked",o[s])}})})}},p[wpoptimize.close_btn]=function(){U(this).dialog("destroy")},o.dialog({autoOpen:!1,title:t,minWidth:800,modal:!0,open:function(){U(this).dialog("option","minHeight",300)},close:function(){U(this).dialog("destroy"),U("#wpo-popup-preview").html("")},buttons:p}),U("#wpo-preview-tablesorter").hide(),o.html(s),U(".ui-dialog-buttonpane button").first().hide(),U(".ui-dialog-buttonpane").prepend([n,a].join("")),U("#pager").show(),U(".ui-dialog-title").append(['<i id="wpo-preview-loader"><img width="12" height="12" src="',wpoptimize.spinner_src,'" /></i>'].join(""));var r=U("#wpo-preview-loader > img"),l=U("#wpo-preview-site"),c=new WPO_Table_DataSource({optimization_id:i,limit:1});for(var d in e)"id"!=d&&"title"!=d&&c.set_option(d,e[d]);l.length&&l.val()&&c.set_option("site_id",l.val()),l.on("change",function(){c.set_option("site_id",l.val()),U("#wpo-preview-tablesorter").trigger("reload")}),c.fetch().done(function(e){var i=U("#wpo-preview-tablesorter");try{e=wpo_parse_json(e)}catch(t){return void alert(wpoptimize.error_unexpected_response)}i.hide();var s,n=[],a=[],_=1,p={0:{sorter:!1}};n.push('<th style="width: 20px"><input id="wpo-select-all-preview-rows" type="checkbox" /></th>'),a.push("<th></th>");for(s in e.result.columns)e.result.columns.hasOwnProperty(s)&&(p[_]={sorter:!1},_++,n.push(['<th class="header">',e.result.columns[s],"</th>"].join("")),a.push(["<th>",e.result.columns[s],"</th>"].join("")));i.append(["<thead><tr>",n.join(""),"</tr></thead>"].join("")),i.append(["<tfoot><tr>",a.join(""),"</tr></tfoot>"].join("")),i.append("<tbody></tbody>");const d=i[0],l=new WPO_TablePager({table:d,container:document.getElementById("pager"),dataSource:c});l.loadTableData(),d.addEventListener("reload",function(){l.loadTableData()}),d.addEventListener("load_start",function(){r.show()}),d.addEventListener("load_end",function(e){var i=e.detail.response;r.hide(),parseInt(i.result.total)>0?(U("#wpo-preview-tablesorter").show(),U("#wpo-preview-message").hide(),U(".ui-dialog-buttonpane #pager").show(),U(".ui-dialog-buttonpane button").first().show(),o.dialog("option","height",300)):(U("#wpo-preview-tablesorter").hide(),U("#wpo-preview-message").text(i.result.message).show(),U(".ui-dialog-buttonpane #pager").hide(),U(".ui-dialog-buttonpane button").first().hide()),U("#wpo-preview-site").show()})}),o.dialog("open")}function M(e){var i={};i.is_enabled=U("#enable-db-analysis").is(":checked"),WP_Optimize.send_command("save_table_analysis_options",i,function(i){i.message&&(N(i.message),e())})}function A(){setTimeout(function(){U("#wpo-save-options-response").html(""),U("#wpo-save-options-response").hide()},3e3)}function N(e){U("#wpo-save-options-response").show(),U("#wpo-save-options-response").html(e),A()}function G(){U("#wpo_loading_spinner span, #wpo_loading_spinner img").removeClass("hidden").show(),F()&&!U("div.blockUI").is(":visible")&&wp_optimize.block_ui(wpoptimize.no_information_available_yet+" "+wpoptimize.please_wait_a_few_seconds_while_we_refresh,{},0,!1),WP_Optimize.send_command("get_table_analysis_data",{"selected-plugin":U("#wpo-plugin-usage-select").val()},function(e){U("#wpo_loading_spinner span, #wpo_loading_spinner img").addClass("hidden").hide(),U("#wpo-table-analysis-report-container").html(e.html),H(),F()?setTimeout(G,5e3):U.unblockUI()})}function W(){U("#wpo-wipe-table-usage-data").on("click",function(e){e.preventDefault(),U("#wpo-save-options-response").html(wpoptimize.please_wait),WP_Optimize.send_command("wipe_table_analysis_data",{},function(e){N(e.message),G()})}),U("#enable-db-analysis").on("change",function(){M(G)})}function F(){var e=U("#enable-db-analysis").prop("checked"),i=U("#wpo-plugin-usage-select").is(":visible");return e&&!i}function H(){U("#wpo-plugin-usage-select").on("change",function(){U(".wpo-plugin-tables-usage").hide(),U("#wpo-plugin-tables-usage-"+this.value).show(),""!=this.value?U("#wpo-db-analysis-table-search, #wpo-table-analysis-reload").removeClass("hidden"):U("#wpo-db-analysis-table-search, #wpo-table-analysis-reload").addClass("hidden")}),U("#wpo-db-analysis-table-search").on("keyup",function(){var e=this.value;U(".wpo-plugin-tables-usage #the-list tr").each(function(){var i=this;U(this).children("td:nth-child(2)").each(function(){this.innerHTML.indexOf(e)>-1?U(i).show():U(i).hide()})})}),U("#wpo-db-analysis-table-search").on("keypress",function(e){13===e.keyCode&&e.preventDefault()}),U("#wpo-table-analysis-reload").on("click",G)}function R(e){var i=Ae.next(".wpo_spinner"),t=i.next(".dashicons-yes");i.show(),$(wpoptimize.saving);var o={images_dimensions:Me.is(":checked"),ignore_classes:Ne.val()};L("save_images_dimension_option",o,function(o){i.hide(),U.unblockUI(),o.success&&"save_button"===e&&t.fadeIn("fast").fadeOut("slow")})}var U=jQuery,L=WP_Optimize.send_command,Z=WP_Optimize.optimization_get_info,B=WP_Optimize.take_a_backup_with_updraftplus,Q=WP_Optimize.save_auto_backup_options,$=wp_optimize.block_ui,Y=U("#wp-optimize-nav-tab-wpo_images-unused-contents"),V=U("#wpo-unused-images-section"),X=U("#wpo-unused-image-sizes-section"),q=U("#wpo_unused_images"),J=U("#wpo_unused_images_trash"),K=U("#wpo_unused_images_view_images_btn"),ee=U("#wpo_unused_images_view_trash_btn"),ie=U("#wpo_scan_for_unused_images_trash_info > a"),te=U("#wpo_restore_unused_images_from_trash_btn"),oe=U("#wpo_remove_unused_images_btn"),se=U("#wpo_move_unused_images_to_trash_btn"),ne=U("#wpo_remove_unused_images_from_trash_btn"),ae=U("#wpo_remove_selected_sizes_btn"),_e=U("#wpo_unused_images_refresh"),pe=U("#wpo_unused_image_sizes_refresh"),de=U("#wpo_unused_images_select_all"),re=U("#wpo_unused_images_select_none"),le=U("#wpo_scan_for_unused_images"),ce=U("#wpo_scan_for_unused_image_sizes"),ue=U("#wpo_unused_images_sites_select_container"),me=U("#wpo_unused_images_sites_select"),he=U("#enable-auto-backup-2"),we=U("#enable-auto-backup-3"),ge=wpoptimize.sites.length>1?[U("#wpo_unused_images_loaded_count")]:[U("#wpo_unused_images_control_panel"),U("#wpo_unused_images_loaded_count")],fe=wpoptimize.sites.length>1?[U("#wpo_unused_images_trash_loaded_count")]:[U("#wpo_unused_images_control_panel"),U("#wpo_unused_images_trash_loaded_count")],ve={DETECT_IMAGES:"detect_unused_images",DETECT_SIZES:"detect_images_sizes",DETECT_BOTH:"detect_both"},be={COMPLETE:"complete",SUCCESS:"success",FAILURE:"failure",BUSY:"busy"},ye={GET_INFO_START:"optimization_get_info_images_start",GET_INFO_PROCESS:"optimization_get_info_images",GET_INFO_PROCESS_XHR_UPDATE:"optimization_get_info_xhr_images",GET_INFO_DONE:"optimization_get_info_images_done",OPTIMIZATION_START:"do_optimization_images_start",OPTIMIZATION_DONE:"do_optimization_images_done"},ze=new WP_Optimize_Images_View({container:q,no_images_found_message:wpoptimize.no_unused_images_found,related_elements:[U(".wpo-last-scan-info",V),U(".wpo-unused-images-el"),U(".wpo-image-sizes-section"),U("#wpo_unused_images_loaded_count"),U("#wpo_unused_images_refresh")],row_action_buttons:[{"class":"wpo_unused_images_move_to_trash_single button button-primary",title:wpoptimize.trash,hint:wpoptimize.move_to_trash},{"class":"wpo_unused_images_remove_single button button-link button-link-delete",title:wpoptimize["delete"],hint:wpoptimize.permanently_delete}],action_buttons:[oe,se],hide_when_empty:ge,loader_additional_html:'<a class="wpo-unused-images-cancel-scan" data-mode="'+ve.DETECT_IMAGES+'">'+wpoptimize.cancel_scan+"</a>",load_next_page_callback:c}),ke=new WP_Optimize_Images_View({container:J,no_images_found_message:wpoptimize.no_unused_trash_images_found,related_elements:[U(".wpo-unused-images-trash-el"),U("#wpo_unused_images_trash_loaded_count")],row_action_buttons:[{"class":"wpo_unused_images_restore_from_trash_single button",title:wpoptimize.restore,hint:wpoptimize.restore_from_trash},{"class":"wpo_unused_images_remove_single_from_trash button button-primary",title:wpoptimize["delete"],hint:wpoptimize.permanently_delete}],action_buttons:[te,ne],hide_when_empty:fe,load_next_page_callback:u,onclear:function(){Se[j()]=""}}),Oe=!1,Ee=!1,Te={},Pe={},xe=parseInt(wpoptimize.unused_images_per_page),Ie={},Ce={},je={},Se={},De={},Me=U("#images_dimensions"),Ae=U("#image_dimensions_save_settings_btn"),Ne=U("#image_dimensions_ignore_classes"),Ge=U("#image_dimensions_hidden_content");le.on("click",function(){l(ve.DETECT_IMAGES,!0)}),ce.on("click",function(){l(ve.DETECT_SIZES,!0)}),Y.on("click",".wpo-unused-images-cancel-scan",function(){var e=U(this),i=e.data("mode"),t={mode:i,cancel:!0},o={optimization_id:"images",data:t};e.prop("disabled")||(e.prop("disabled",!0),s(i),L("get_optimization_info",o,function(e){U(document).trigger(ye.GET_INFO_DONE,o)}).always(function(){e.prop("disabled",!1)}))}),ee.on("click",function(){return!U(this).prop("disabled")&&(ee.hide(),K.show(),ee.data("dirty")&&(ee.data("dirty",!1),ke.clear()),ze.hide(),ke.show(),Y.addClass("wpo-unused-images-trash-view"),!1)}),K.on("click",function(){return!U(this).prop("disabled")&&(K.hide(),ee.show(),ke.hide(),ze.show(),Y.removeClass("wpo-unused-images-trash-view"),K.data("before-scan")&&(jQuery(".wpo-unused-images-section-loaded").addClass("wpo_hidden"),jQuery(".wpo-unused-images-section-unloaded").show(),K.data("before-scan",!1)),K.data("dirty")&&(K.data("dirty",!1),d(!1)),!1)}),ie.on("click",function(){jQuery(".wpo-unused-images-section-unloaded").hide(),jQuery(".wpo-unused-images-section-loaded").removeClass("wpo_hidden"),ee.trigger("click"),K.data("before-scan",!0)}),U(document).on(ye.GET_INFO_START,function(e,i){var t=i&&i.hasOwnProperty("mode")?i.mode:"";_e.prop("disabled",!0),t==ve.DETECT_IMAGES&&(U(".wpo_shade",V).show(),U(".wpo-shade-progress-message",V).text("")),t==ve.DETECT_SIZES&&(U(".wpo_shade",X).show(),U(".wpo_unused_images_loader",X).show(),U(".wpo-shade-progress-message",X).text("")),r(!0)}),U(document).on(ye.GET_INFO_PROCESS,function(e,i,t){var o=t&&t.hasOwnProperty("mode")?t.mode:"";o==ve.DETECT_IMAGES&&(U(".wpo-shade-progress-message",V).text(i),ze.loader_message(i)),o==ve.DETECT_IMAGES&&U(".wpo-shade-progress-message",X).text(i)}),U(document).on(ye.GET_INFO_PROCESS_XHR_UPDATE,function(e,i,t){t.hasOwnProperty("mode")&&(De[t.mode]=i)}),U(document).on(ye.GET_INFO_DONE,function(e,i){U("#wpo_unused_images_shade").remove(),U(".wpo_unused_images_loader").hide(),_e.prop("disabled",!1);var t=w(i),o=t&&t.hasOwnProperty("mode")?t.mode:!!(i&&i.hasOwnProperty("data")&&i.data.hasOwnProperty("mode"))&&i.data.mode,s=i&&i.hasOwnProperty("data")&&i.data.hasOwnProperty("cancel")||o&&De.hasOwnProperty(o)&&De[o].hasOwnProperty("statusText")&&"abort"==De[o].statusText;if(ve.DETECT_IMAGES==o&&(U(".wpo_shade",V).hide(),ze.hide_loader(),s||(U(".wpo-unused-images-section-unloaded").hide(),U(".wpo-unused-images-section-loaded").removeClass("wpo_hidden"),g(i,f))),ve.DETECT_SIZES==o&&(U(".wpo_shade",X).hide(),s||(U(".wpo-unused-image-sizes-section-unloaded").hide(),U(".wpo-unused-image-sizes-section-loaded").removeClass("wpo_hidden"),g(i,v))),ve.DETECT_BOTH==o){var n=["last_scan_",ve.DETECT_IMAGES].join(""),a=["last_scan_",ve.DETECT_SIZES].join("");t&&t[n]?(U(".wpo-unused-images-section-unloaded").hide(),U(".wpo-unused-images-section-loaded").removeClass("wpo_hidden"),U(".wpo_shade",V).hide(),g(i,f)):t.hasOwnProperty("trash_images_count")&&t.trash_images_count>0&&(U("#wpo_scan_for_unused_images_trash_info > span").text(t.trash_images_count_message),U("#wpo_scan_for_unused_images_trash_info").css("display","block")),t&&t[a]&&(U(".wpo-unused-image-sizes-section-unloaded").hide(),U(".wpo-unused-image-sizes-section-loaded").removeClass("wpo_hidden"),U(".wpo_shade",X).hide(),g(i,v))}r(!1)}),U(document).on(ye.OPTIMIZATION_START,function(){Oe=!0,U(".wpo_unused_images_loader").show(),r(!0)}),U(document).on(ye.OPTIMIZATION_DONE,function(e,i){U(".wpo_unused_images_loader").hide(),r(!1),g(i,f),alert(i.result.meta.removed_message)}),oe.on("click",function(){0!=U('#wpo_unused_images input[type="checkbox"]:checked').length&&(Q(),he.is(":checked")?B(T,"uploads"):T())}),se.on("click",function(){0!=U('#wpo_unused_images input[type="checkbox"]:checked').length&&(Q(),he.is(":checked")?B(n,"uploads"):n())}),ne.on("click",function(){0!=ke.get_selected_images().length&&(Q(),he.is(":checked")?B(a,"uploads"):a())}),te.on("click",function(){0!=ke.get_selected_images().length&&(Q(),he.is(":checked")?B(_,"uploads"):_())}),ae.on("click",function(){Q(),we.is(":checked")?B(I):I()}),_e.on("click",function(e){e.preventDefault(),U(this).prop("disabled")||d(!0)}),pe.on("click",function(e){if(e.preventDefault(),!U(this).prop("disabled")){var i={forced:!0,mode:ve.DETECT_SIZES};U(".wpo_unused_images_loader",X).show(),U(document).trigger(ye.GET_INFO_START,i),Z(U(".wpo-shade-progress-message"),"images",i).fail(function(){U(document).trigger(ye.GET_INFO_DONE,i)})}}),de.on("click",function(){ze.is_visible()&&ze.select_all(),ke.is_visible()&&ke.select_all()}),re.on("click",function(){ze.is_visible()&&ze.select_none(),ke.is_visible()&&ke.select_none()}),U("#wp-optimize-nav-tab-wrapper__wpo_images .nav-tab").on("click",function(){t("wpo_images-unused")&&o()}),t("wpo_images-unused")&&o(),me.on("change",function(){var e=j();y(e),m(e)}),U(".wpo_unused_images_switch_view a").on("click",function(){E(U(this).data("mode"))}),q.on("click",".wpo_unused_images_remove_single",function(){var e=U(this),i=e.closest(".wpo_unused_image"),t=U('input[type="checkbox"]',i).attr("value");U("button",i).prop("disabled",!0),P([t]).done(function(){i.remove()})}),q.on("click",".wpo_unused_images_move_to_trash_single",function(){var e=U(this),i=e.closest(".wpo_unused_image"),t=U('input[type="checkbox"]',i).attr("value");U("button",i).prop("disabled",!0),n([t]).done(function(){i.remove()})}),J.on("click",".wpo_unused_images_restore_from_trash_single",function(){var e=U(this),i=e.closest(".wpo_unused_image"),t=U('input[type="checkbox"]',i).attr("value");U("button",i).prop("disabled",!0),_([t],i).done(function(){i.remove()})}),J.on("click",".wpo_unused_images_remove_single_from_trash",function(){var e=U(this),i=e.closest(".wpo_unused_image"),t=U('input[type="checkbox"]',i).attr("value");U("button",i).prop("disabled",!0),a([t],i).done(function(){i.remove()})}),U("#wpo_lazy_load_settings").on("click",".wp-optimize-settings-save",function(){var e=U(this),i=e.next(".wpo_spinner"),t=i.next(".dashicons-yes");i.show(),S(function(){i.hide(),t.removeClass("display-none").show().delay(5e3).fadeOut("fast",function(){t.addClass("display-none")})})}),U("body").append('<div id="wpo-popup-preview"></div>'),U("#wp-optimize-nav-tab-WP-Optimize-optimize-contents").on("click","#remove_all_transients",function(){var e=U(this).closest("td"),i=U(this).is(":checked");U("a",e).each(function(){U(this).data("remove_all_transients",i)})}),U("#wp-optimize-nav-tab-WP-Optimize-optimize-contents").on("click",".wpo-optimization-preview",function(){return D(U(this).data()),!1}),U("#wpo-popup-preview").on("change","#wpo-select-all-preview-rows",function(){var e=U(this).closest("table"),i=U(this).prop("checked");U("input:checkbox",e).each(function(){U(this).is("#wpo-select-all-preview-rows")||U(this).prop("checked",i)})}),U("#remove_all_transients").on("change",function(){var e=U(this).closest("td"),i=U(this).is(":checked");U("a",e).each(function(){U(this).data("remove_all_transients",i)})});var We=U("#wpo_always_purge_table"),Fe=U("#wpo_always_purge_post_types_select"),He=U("#wpo_always_purge_post_id_select");U("#wpo_add_always_purge_btn").on("click",function(){var e=U(this),i=e.closest("tr"),t=U("#wpo_always_purge_post_types_select",i),o=t.val(),s=U("#wpo_always_purge_post_id_select",i),n=s.val(),a=U(['option[value="',n,'"]'].join("")).text(),_=!0,p=[];U("#wpo_always_purge_post_types_select",i).find(":selected").each(function(){p.push(U(this).text())});var d=['<tr><td><input type="hidden" class="cache-settings-array" name="always_purge_post_type" value="',o.join(","),'">',p.join(", "),'</td><td><input type="hidden" class="cache-settings-array" name="always_purge_post_id" value="',n,'">',a,'</td><td><a class="wpo-always-purge-delete wpo-delete" href="javascript: ;">',wpoptimize["delete"],"</a></td></tr>"].join("");0==o.length&&(_=!1,U(".select2-selection",t.next()).addClass("wpo_error_field")),n||(_=!1,U(".select2-selection",s.next()).addClass("wpo_error_field")),_&&(U(".select2-selection",t.next()).removeClass("wpo_error_field"),U(".select2-selection",s.next()).removeClass("wpo_error_field"),t.val(null).trigger("change"),s.val(null).trigger("change"),i.before(d))}),We.on("click",".wpo-always-purge-delete",function(){var e=U(this),i=e.closest("tr");i.remove()}),Fe.select2(),He.select2({ajax:{url:ajaxurl,type:"post",dataType:"json",data:function(e){var i={action:"wp_optimize_ajax",subaction:"get_posts_list",nonce:wp_optimize_send_command_data.nonce,data:{search:e.term,page:e.page||1}};return i}}});var Re=U("#enable_per_role_cache"),Ue=U("#wpo_per_role_cache_roles_list");return Re.on("change",function(){Re.prop("checked")?Ue.removeClass("wpo_hidden"):Ue.addClass("wpo_hidden")}),W(),H(),Me.on("click",function(){Ge.css("display",Me.is(":checked")?"block":"none"),R("toggle_button")}),Ae.on("click",function(){R("save_button")}),{reload_table_analysis_report:G}};jQuery(function(e){function i(e,i){var t="";switch(e){case"wpo_once":t=WP_Optimize_Handlebars.once.handlebars({details:i});break;case"wpo_daily":t=WP_Optimize_Handlebars.daily.handlebars({details:i});break;case"wpo_weekly":t=WP_Optimize_Handlebars.weekly.handlebars({details:i});break;case"wpo_fortnightly":t=WP_Optimize_Handlebars.fortnightly.handlebars({details:i});break;case"wpo_monthly":t=WP_Optimize_Handlebars.monthly.handlebars({details:i})}return t}function t(){e(".wpo_auto_optimizations").select2({placeholder:wpoptimize.select_optimizations}),e(".wpo_auto_optimizations").on("select2:opening select2:closing",function(i){var t=e(this).parent().find(".select2-search__field");t.prop("disabled",!0)})}function o(){0===e(".wpo_scheduled_event:visible").length?(e(".wpo_auto_event_heading_container").hide(),e(".wpo_no_schedules").show()):(e(".wpo_auto_event_heading_container").show(),e(".wpo_no_schedules").hide()),0!==e(".wpo_scheduled_event:visible").length||0!==e(".wpo_auto_event:visible").length||e("#save_settings_reminder").is(":visible")?e(".wpo_no_schedules").hide():e(".wpo_no_schedules").show()}function s(e){return month=""+(e.getMonth()+1),day=""+e.getDate(),year=e.getFullYear(),month.length<2&&(month="0"+month),day.length<2&&(day="0"+day),[year,month,day].join("-")}var n=e("#wp-optimize-auto-options"),a=e("#database_settings_form"),_=e('input[type="time"]'),p=e('input[type="date"]'),d=((new Date).toISOString().split("T")[0],e(".wpo_auto_event:last").data("count")||0);_.each(function(i,t){Modernizr.inputtypes.time||(e(t).timepicker({timeFormat:"H:i"}),e(t).addClass("no_date_time_support"),e(t).on("changeTime",function(){e(this).timepicker("hide")}))}),n.on("focus",'input[type="time"]',function(){var i=e(this).get(0);Modernizr.inputtypes.time||(e(i).timepicker({timeFormat:"H:i"}),e(i).on("changeTime",function(){e(this).timepicker("hide")}))}),n.on("keypress","input",function(e){if(13===e.keyCode)return!1}),p.each(function(i,t){Modernizr.inputtypes.date||(e(t).datepicker({dateFormat:"yy-mm-dd",minDate:0}),e(t).addClass("no_date_time_support"))}),n.on("focus",'input[type="date"]',function(){var i=e(this).get(0);Modernizr.inputtypes.date||e(i).datepicker({dateFormat:"yy-mm-dd",minDate:0})}),0!==e(".wpo_scheduled_event").length?e(".wpo_no_schedules").hide():e(".wpo_no_schedules").show(),e(".wpo_auto_optimizations").select2({placeholder:wpoptimize.select_optimizations}),e(".wpo_auto_optimizations").on("select2:opening select2:closing",function(i){var t=e(this).parent().find(".select2-search__field");t.prop("disabled",!0)}),e("#purge_cache_permissions").select2({placeholder:wpoptimize.select_roles}),n.on("change",'select, input[type="date"], input[type="time"]',function(){e("#save_settings_reminder").slideDown(),o()}),a.on("click","#wpo-add-event",function(i){i.preventDefault(),d++;var t=WP_Optimize_Handlebars.optimizations.handlebars({optimizations:wpoptimize.auto_optimizations,count:d}),o=WP_Optimize_Handlebars.schedule_types.handlebars({schedule_types:wpoptimize.schedule_types,
count:d}),s=wpoptimize.add_schedule_new,n=wpoptimize.add_schedule_cancel,a=WP_Optimize_Handlebars.action.handlebars({count:d,add_schedule_new:s,add_schedule_cancel:n}),_='<div class="wpo_auto_event wpo_cf" data-count="'+d+'">';_+=t+o+a,_+="</div>",e("#wpo_auto_events").append(_),e(".wpo_auto_optimizations").select2({placeholder:wpoptimize.select_optimizations}),e(".wpo_auto_optimizations").on("select2:opening select2:closing",function(i){var t=e(this).parent().find(".select2-search__field");t.prop("disabled",!0)})}),a.on("change",".wpo_schedule_type",function(){var t=e(this).closest(".wpo_auto_event"),o=wpoptimize.add_schedule_new,n=wpoptimize.add_schedule_cancel,a=t.data("count")||d,_=e(this).val(),p="";Modernizr.inputtypes.date&&Modernizr.inputtypes.time||(p="no_date_time_support");var r=new Date,l=s(r),c={date:wpoptimize.date,time:wpoptimize.time,day:wpoptimize.day,day_number:wpoptimize.day_number,days:wpoptimize.days,date_value:l,time_value:"00:00",status:wpoptimize.active,status_value:"checked",week_days:wpoptimize.week_days,week:wpoptimize.week,count:a,class_name:p,today:r},u=i(_,c),m=WP_Optimize_Handlebars.status.handlebars({details:c}),h=WP_Optimize_Handlebars.action.handlebars({add_schedule_new:o,add_schedule_cancel:n});e(this).next().html(""),t.find(".wpo_event_status").remove(),t.find(".wpo_event_actions").remove(),""!==u&&e(this).next().html(u),t.append(m+h)}),a.on("click","#wp-optimize-auto-options .wpo_edit_event",function(){var i=e(this).closest(".wpo_scheduled_event");i.hide(),i.next().show(),o(),t()}),a.on("click",".wpo_remove_event",function(){var i=e(this).data("count"),t=confirm(wpoptimize.confirm_remove_task);if(!0===t){var s=e(this).closest(".wpo_scheduled_event"),n=e(this).closest(".wpo_auto_event");i==s.next().data("count")&&(s.next().remove(),s.remove()),i==n.prev().data("count")&&n.prev().remove(),n.remove(),setTimeout(function(){e("#wp-optimize-save-database-settings").trigger("click")},500),o()}}),a.on("click","#wp-optimize-auto-options .wpo_cancel_event",function(){var i=e(this).closest(".wpo_auto_event");i.hide(),i.prev().show()}),e("#database_settings_form").on("wpo-saving-form-data",function(i){var t=!0,s=e("#database_settings_form");s.find(".wpo_auto_optimizations").each(function(){var i=e(this).val();Array.isArray(i)&&0===i.length&&(t=!1)}),s.find(".wpo_schedule_type").each(function(){e(this).val()||(t=!1)}),s.find(".wpo_schedule_fields input").each(function(){var i=e(this).val(),o=e(this)[0].type;switch(o){case"date":var s=i.split("-"),n=parseInt(s[2]),a=parseInt(s[1])-1,_=parseInt(s[0]),p=new Date(_,a,n);p instanceof Date&&isNaN(p)&&(t=!1);break;case"time":var d=/^([0-1]?[0-9]|2[0-4]):([0-5][0-9])(:[0-5][0-9])?$/;d.test(i)||(t=!1)}}),!1===t?(s.form_errors.add("missing-fields",""),i.stopImmediatePropagation(),s.find(".wp-optimize-settings-save-results").show().addClass("wpo_alert_notice").text(wpoptimize.fill_all_fields).delay(5e3).fadeOut(3e3,function(){e(this).removeClass("wpo_alert_notice")})):s.form_errors.remove("missing-fields"),e("#save_settings_reminder").slideUp("normal",function(){o()})}),e("#enable_css_minification").on("click",function(){var i=e("#enable_unused_css_removal_wrapper"),t=e(this).prop("checked");t?i.show():(i.hide(),e("#enable_unused_css").prop("checked",!1))})});